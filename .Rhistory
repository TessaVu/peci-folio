ggdraw() +
draw_label("Vulnerability Analysis: Philadelphia Census Tracts",
fontfamily = default_font_family, fontface = "bold", size = 16),
ggdraw() +
draw_label("Environmental Justice Index (EJI), Social Vulnerability Index (SVI), and Bivariate Analysis",
fontfamily = default_font_family, size = 12, color = "#666666"),
master_grid,
legend_panel,
ncol = 1,
rel_heights = c(0.04, 0.03, 0.83, 0.1)
)
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank()
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| include: false
# ------ SAVE OUTPUTS ------
# Individual maps
ggsave("complete_pfas_panel.png", pfas_panel_titled,
width = 18, height = 7, dpi = 300, bg = "#dedbd4")
ggsave("complete_mp_panel.png", mp_panel_titled,
width = 18, height = 7, dpi = 300, bg = "#dedbd4")
# Master grid
ggsave("complete_master_grid.png", master_grid_with_legend,
width = 18, height = 16, dpi = 300, bg = "#dedbd4")
# Correlation plot
ggsave("complete_correlation_analysis.png", correlation_plot,
width = 7, height = 7, dpi = 300, bg = "#dedbd4")
# High-resolution version for publication
ggsave("complete_master_grid_hires.pdf", master_grid_with_legend, bg = "#dedbd4",
width = 18, height = 16, device = "pdf")
#| echo: false
#| message: false
#| warning: false
#| include: false
# ------ SUMMARY REPORT ------
# Calculate summary statistics
summary_stats <- map_tracts %>%
st_drop_geometry() %>%
group_by(bi_class, label) %>%
summarise(
n_tracts = n(),
mean_svi = mean(RPL_themes, na.rm = TRUE),
mean_eji = mean(RPL_EJI_CBM, na.rm = TRUE),
sd_svi = sd(RPL_themes, na.rm = TRUE),
sd_eji = sd(RPL_EJI_CBM, na.rm = TRUE),
.groups = "drop"
) %>%
arrange(bi_class)
# Count POIs by bivariate class
poi_summary <- bind_rows(
map_tracts %>%
st_join(PFAS_POI %>% mutate(poi_type = "PFAS")) %>%
st_drop_geometry() %>%
filter(!is.na(poi_type)) %>%
count(bi_class, label, poi_type),
map_tracts %>%
st_join(MP_POI %>% mutate(poi_type = "MP")) %>%
st_drop_geometry() %>%
filter(!is.na(poi_type)) %>%
count(bi_class, label, poi_type)
) %>%
pivot_wider(names_from = poi_type, values_from = n, values_fill = 0)
# Combine and save
final_summary <- summary_stats %>%
left_join(poi_summary, by = c("bi_class", "label")) %>%
replace_na(list(PFAS = 0, MP = 0))
write_csv(final_summary, "complete_analysis_summary.csv")
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),
panel.background = "#f5f4f0",
plot.background = "#f5f4f0"
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),
panel.background = element_rect(color = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),
panel.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"),
panel.background = element_rect(color = "#dedbd4", fill = "#dedbd4"),
plot.background = element_rect(color = "#dedbd4", fill = "#dedbd4")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, face = "italic", color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
axis.title.x = element_text(margin = margin(t = 10, unit = "pt")),
axis.title.y = element_text(margin = margin(r = 10, unit = "pt")),
panel.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, face = "italic", color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
axis.title.x = element_text(margin = margin(t = 0.5, unit = "cm")),
axis.title.y = element_text(margin = margin(r = 0.5, unit = "cm")),
panel.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, face = "italic", color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
axis.title.x = element_text(margin = margin(t = 0.5, unit = "cm")),
axis.title.y = element_text(margin = margin(r = 0.5, unit = "cm")),
panel.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, face = "italic", color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
axis.title.x = element_text(margin = margin(t = 0.5, unit = "cm")),
axis.title.y = element_text(margin = margin(r = 0.5, unit = "cm")),
panel.background = element_rect(color = "#F2F0EF", fill = "#F2F0EF"),
plot.background = element_rect(color = "#F2F0EF", fill = "#F2F0EF")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
#| echo: false
#| include: false
#| message: false
#| warning: false
# ------ CORRELATION ANALYSIS ------
correlation_plot <- map_tracts %>%
st_drop_geometry() %>%
filter(!is.na(RPL_themes) & !is.na(RPL_EJI_CBM)) %>%
ggplot(aes(x = RPL_EJI_CBM, y = RPL_themes)) +
geom_point(aes(fill = fill), shape = 21, size = 2.5,
color = "white", stroke = 0.5, alpha = 0.7) +
scale_fill_identity() +
geom_smooth(method = "lm", se = TRUE, color = "#DC143C",
size = 0.8, alpha = 0.3) +
geom_density_2d(color = "#666666", alpha = 0.5, size = 0.3) +
labs(
x = "Environmental Justice Index (EJI)",
y = "Social Vulnerability Index (SVI)",
title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, face = "italic", color = "#666666"),
panel.grid.minor = element_blank(),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8, face = "italic"),
axis.title.x = element_text(margin = margin(t = 0.5, unit = "cm")),
axis.title.y = element_text(margin = margin(r = 0.5, unit = "cm")),
panel.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0"),
plot.background = element_rect(color = "#f5f4f0", fill = "#f5f4f0")
) +
coord_fixed()
#| echo: false
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 10
#| fig-width: 10
correlation_plot
# Correlation plot
ggsave("complete_correlation_analysis.png", correlation_plot, width = 10, height = 10, dpi = 300, bg = "#dedbd4")
