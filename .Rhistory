title = "Correlation Analysis",
subtitle = sprintf("r = %.3f | Census Tracts Colored by Bivariate Class",
cor(map_tracts$RPL_themes, map_tracts$RPL_EJI_CBM,
use = "complete.obs"))
) +
scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
scale_y_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2)) +
theme_minimal() +
theme(
text = element_text(family = default_font_family),
plot.title = element_text(size = 12, face = "bold"),
plot.subtitle = element_text(size = 10, color = "#666666"),
panel.grid.minor = element_blank()
) +
coord_fixed()
# ---- Save All Outputs ----
# Individual maps
ggsave("complete_pfas_panel.png", pfas_panel_titled,
width = 18, height = 7, dpi = 300, bg = "#dedbd4")
ggsave("complete_mp_panel.png", mp_panel_titled,
width = 18, height = 7, dpi = 300, bg = "#dedbd4")
# Master grid
ggsave("complete_master_grid.png", master_grid_with_legend,
width = 18, height = 16, dpi = 300, bg = "#dedbd4")
# Correlation plot
ggsave("complete_correlation_analysis.png", correlation_plot,
width = 7, height = 7, dpi = 300, bg = "#dedbd4")
# High-resolution version for publication
ggsave("complete_master_grid_hires.pdf", master_grid_with_legend, bg = "#dedbd4",
width = 18, height = 16, device = "pdf")
# ---- Helper Function for POI Annotations ----
add_poi_layer <- function(base_plot, poi_data, poi_color, n_labels) {
# Extract coordinates
poi_coords <- st_coordinates(poi_data) %>%
as_tibble() %>%
rename(x = X, y = Y)
poi_labels <- poi_data %>%
st_drop_geometry() %>%
bind_cols(poi_coords) %>%
slice_head(n = n_labels)
# Add points and labels
base_plot +
geom_sf(
data = poi_data,
color = "white",
fill = poi_color,
size = 3,
shape = 21,
stroke = 1,
alpha = 1
) +
geom_label_repel(
data = poi_labels,
aes(x = x, y = y, label = str_wrap(Name, 15)),
size = 2,
family = default_font_family,
box.padding = unit(20, "mm"),
point.padding = unit(4, "mm"),
max.overlaps = Inf,
force = 10,
direction = "both",
min.segment.length = 0,
segment.color = poi_color,
segment.size = 0.5,
fill = alpha("white", 0.8),
label.size = 0.1,
arrow = arrow(length = unit(0.2, "cm"))
)
}
# ---- Create Individual Univariate Maps ----
# Function for univariate maps
create_univariate_map <- function(data, var, var_name, color_option = "viridis") {
# Create quintiles
quintiles <- quantile(data[[var]], probs = seq(0, 1, 0.2), na.rm = TRUE)
labels <- sprintf("Q%d: %.2f-%.2f", 1:5,
quintiles[1:5], quintiles[2:6])
data <- data %>%
mutate(var_class = cut(.data[[var]], breaks = quintiles,
labels = labels, include.lowest = TRUE))
ggplot(data) +
geom_sf(aes(fill = var_class), color = "#f5f4f0", linewidth = 0.5) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.5
) +
scale_fill_viridis_d(name = var_name, option = color_option, direction = -1,
alpha = 0.8, begin = 0.1, end = 0.9) +
theme_universal_map()
}
# Create EJI maps
map_eji <- create_univariate_map(map_tracts, "RPL_EJI_CBM", "EJI\nPercentile", "rocket")
map_eji_pfas <- add_poi_layer(map_eji, PFAS_POI, "#DC143C", 0) +
labs(title = "Environmental Justice Index",
subtitle = "PFAS Sampling Locations")
map_eji_mp <- add_poi_layer(map_eji, MP_POI, "#DC143C", 0) +
labs(title = "Environmental Justice Index",
subtitle = "Microplastic Sampling Locations")
# Create SVI maps
map_svi <- create_univariate_map(map_tracts, "RPL_themes", "SVI\nPercentile", "rocket")
map_svi_pfas <- add_poi_layer(map_svi, PFAS_POI, "#DC143C", 0) +
labs(title = "Social Vulnerability Index",
subtitle = "PFAS Sampling Locations")
map_svi_mp <- add_poi_layer(map_svi, MP_POI, "#DC143C", 0) +
labs(title = "Social Vulnerability Index",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Maps ----
# Bivariate base map
map_bivariate_base <- ggplot(map_tracts) +
geom_sf(aes(fill = fill), color = "#f5f4f0", linewidth = 0.5) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.5
) +
scale_fill_identity() +
theme_universal_map()
# Add POIs to bivariate maps
map_bivariate_pfas <- add_poi_layer(map_bivariate_base, PFAS_POI, "#DC143C", 0) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "PFAS Sampling Locations")
map_bivariate_mp <- add_poi_layer(map_bivariate_base, MP_POI, "#DC143C", 0) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Legend ----
bivariate_legend <- ggplot() +
geom_tile(
data = bivariate_colors %>%
separate(group, into = c("svi", "eji"), sep = "-", convert = TRUE),
aes(x = eji, y = svi, fill = fill),
color = "#dedbd4",
size = 1
) +
scale_fill_identity() +
scale_x_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
scale_y_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
labs(x = "EJI →", y = "SVI →") +
theme_minimal() +
theme(
text = element_text(family = default_font_family, size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8),
panel.grid = element_blank(),
plot.background = element_rect(fill = "#dedbd4", color = "#dedbd4")
) +
coord_fixed()
# Add legend to bivariate maps
map_bivariate_pfas_full <- ggdraw() +
draw_plot(map_bivariate_pfas, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
map_bivariate_mp_full <- ggdraw() +
draw_plot(map_bivariate_mp, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_pfas_full
#ggsave("test.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#f5f4f0")
#ggsave("map_bivariate_pfas_full.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
# ---- Create Bivariate Maps ----
# Bivariate base map
map_bivariate_base <- ggplot(map_tracts) +
geom_sf(aes(fill = fill), color = "#f5f4f0", linewidth = 0.5) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.5
) +
scale_fill_identity() +
theme_universal_map()
# Add POIs to bivariate maps
map_bivariate_pfas <- add_poi_layer(map_bivariate_base, PFAS_POI, "#DC143C", 10) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "PFAS Sampling Locations")
map_bivariate_mp <- add_poi_layer(map_bivariate_base, MP_POI, "#DC143C", 27) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Legend ----
bivariate_legend <- ggplot() +
geom_tile(
data = bivariate_colors %>%
separate(group, into = c("svi", "eji"), sep = "-", convert = TRUE),
aes(x = eji, y = svi, fill = fill),
color = "#dedbd4",
size = 1
) +
scale_fill_identity() +
scale_x_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
scale_y_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
labs(x = "EJI →", y = "SVI →") +
theme_minimal() +
theme(
text = element_text(family = default_font_family, size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8),
panel.grid = element_blank(),
plot.background = element_rect(fill = "#dedbd4", color = "#dedbd4")
) +
coord_fixed()
# Add legend to bivariate maps
map_bivariate_pfas_full <- ggdraw() +
draw_plot(map_bivariate_pfas, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
map_bivariate_mp_full <- ggdraw() +
draw_plot(map_bivariate_mp, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
# ---- Helper Function for POI Annotations ----
add_poi_layer <- function(base_plot, poi_data, poi_color, n_labels) {
# Extract coordinates
poi_coords <- st_coordinates(poi_data) %>%
as_tibble() %>%
rename(x = X, y = Y)
poi_labels <- poi_data %>%
st_drop_geometry() %>%
bind_cols(poi_coords) %>%
slice_head(n = n_labels)
# Add points and labels
base_plot +
geom_sf(
data = poi_data,
color = "white",
fill = poi_color,
size = 3,
shape = 21,
stroke = 1,
alpha = 1
) +
geom_label_repel(
data = poi_labels,
aes(x = x, y = y, label = str_wrap(Name, 15)),
size = 2,
family = default_font_family,
box.padding = unit(20, "mm"),
point.padding = unit(4, "mm"),
max.overlaps = Inf,
force = 10,
direction = "both",
min.segment.length = 0,
segment.color = poi_color,
segment.size = 0.5,
fill = alpha("white", 0.8),
label.size = 0.1,
arrow = arrow(length = unit(0.2, "cm"))
)
}
# ---- Create Bivariate Maps ----
# Bivariate base map
map_bivariate_base <- ggplot(map_tracts) +
geom_sf(aes(fill = fill), color = "#f5f4f0", linewidth = 0.75) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.75
) +
scale_fill_identity() +
theme_universal_map()
# Add POIs to bivariate maps
map_bivariate_pfas <- add_poi_layer(map_bivariate_base, PFAS_POI, "#DC143C", 10) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "PFAS Sampling Locations")
map_bivariate_mp <- add_poi_layer(map_bivariate_base, MP_POI, "#DC143C", 27) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Legend ----
bivariate_legend <- ggplot() +
geom_tile(
data = bivariate_colors %>%
separate(group, into = c("svi", "eji"), sep = "-", convert = TRUE),
aes(x = eji, y = svi, fill = fill),
color = "#dedbd4",
size = 1
) +
scale_fill_identity() +
scale_x_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
scale_y_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
labs(x = "EJI →", y = "SVI →") +
theme_minimal() +
theme(
text = element_text(family = default_font_family, size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8),
panel.grid = element_blank(),
plot.background = element_rect(fill = "#dedbd4", color = "#dedbd4")
) +
coord_fixed()
# Add legend to bivariate maps
map_bivariate_pfas_full <- ggdraw() +
draw_plot(map_bivariate_pfas, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
map_bivariate_mp_full <- ggdraw() +
draw_plot(map_bivariate_mp, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_pfas_full
#ggsave("test.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#f5f4f0")
#ggsave("map_bivariate_pfas_full.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
#ggsave("test.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#f5f4f0")
ggsave("map_bivariate_pfas_full.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
# ---- Helper Function for POI Annotations ----
add_poi_layer <- function(base_plot, poi_data, poi_color, n_labels) {
# Extract coordinates
poi_coords <- st_coordinates(poi_data) %>%
as_tibble() %>%
rename(x = X, y = Y)
poi_labels <- poi_data %>%
st_drop_geometry() %>%
bind_cols(poi_coords) %>%
slice_head(n = n_labels)
# Add points and labels
base_plot +
geom_sf(
data = poi_data,
color = "white",
fill = poi_color,
size = 5,
shape = 21,
stroke = 1,
alpha = 1
) +
geom_label_repel(
data = poi_labels,
aes(x = x, y = y, label = str_wrap(Name, 15)),
size = 2,
family = default_font_family,
box.padding = unit(20, "mm"),
point.padding = unit(4, "mm"),
max.overlaps = Inf,
force = 10,
direction = "both",
min.segment.length = 0,
segment.color = poi_color,
segment.size = 0.5,
fill = alpha("white", 0.8),
label.size = 0.1,
arrow = arrow(length = unit(0.2, "cm"))
)
}
# ---- Create Bivariate Maps ----
# Bivariate base map
map_bivariate_base <- ggplot(map_tracts) +
geom_sf(aes(fill = fill), color = "#f5f4f0", linewidth = 0.75) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.75
) +
scale_fill_identity() +
theme_universal_map()
# Add POIs to bivariate maps
map_bivariate_pfas <- add_poi_layer(map_bivariate_base, PFAS_POI, "#DC143C", 10) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "PFAS Sampling Locations")
map_bivariate_mp <- add_poi_layer(map_bivariate_base, MP_POI, "#DC143C", 27) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Legend ----
bivariate_legend <- ggplot() +
geom_tile(
data = bivariate_colors %>%
separate(group, into = c("svi", "eji"), sep = "-", convert = TRUE),
aes(x = eji, y = svi, fill = fill),
color = "#dedbd4",
size = 1
) +
scale_fill_identity() +
scale_x_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
scale_y_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
labs(x = "EJI →", y = "SVI →") +
theme_minimal() +
theme(
text = element_text(family = default_font_family, size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8),
panel.grid = element_blank(),
plot.background = element_rect(fill = "#dedbd4", color = "#dedbd4")
) +
coord_fixed()
# Add legend to bivariate maps
map_bivariate_pfas_full <- ggdraw() +
draw_plot(map_bivariate_pfas, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
map_bivariate_mp_full <- ggdraw() +
draw_plot(map_bivariate_mp, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_pfas_full
#ggsave("test.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#f5f4f0")
ggsave("map_bivariate_pfas_full.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_mp_full
ggsave("map_bivariate_mp_full.png", map_bivariate_mp_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
# ---- Helper Function for POI Annotations ----
add_poi_layer <- function(base_plot, poi_data, poi_color, n_labels) {
# Extract coordinates
poi_coords <- st_coordinates(poi_data) %>%
as_tibble() %>%
rename(x = X, y = Y)
poi_labels <- poi_data %>%
st_drop_geometry() %>%
bind_cols(poi_coords) %>%
slice_head(n = n_labels)
# Add points and labels
base_plot +
geom_sf(
data = poi_data,
color = "white",
fill = poi_color,
size = 4,
shape = 21,
stroke = 1,
alpha = 1
) +
geom_label_repel(
data = poi_labels,
aes(x = x, y = y, label = str_wrap(Name, 15)),
size = 2,
family = default_font_family,
box.padding = unit(20, "mm"),
point.padding = unit(4, "mm"),
max.overlaps = Inf,
force = 10,
direction = "both",
min.segment.length = 0,
segment.color = poi_color,
segment.size = 0.5,
fill = alpha("white", 0.8),
label.size = 0.1,
arrow = arrow(length = unit(0.2, "cm"))
)
}
# ---- Create Bivariate Maps ----
# Bivariate base map
map_bivariate_base <- ggplot(map_tracts) +
geom_sf(aes(fill = fill), color = "#f5f4f0", linewidth = 0.75) +
geom_sf(data = water_poly,
fill = "#d6f1fe",
alpha = 1,
color = "#d6f1fe",
linewidth = 0.75
) +
scale_fill_identity() +
theme_universal_map()
# Add POIs to bivariate maps
map_bivariate_pfas <- add_poi_layer(map_bivariate_base, PFAS_POI, "#DC143C", 10) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "PFAS Sampling Locations")
map_bivariate_mp <- add_poi_layer(map_bivariate_base, MP_POI, "#DC143C", 27) +
labs(title = "Bivariate: EJI × SVI",
subtitle = "Microplastic Sampling Locations")
# ---- Create Bivariate Legend ----
bivariate_legend <- ggplot() +
geom_tile(
data = bivariate_colors %>%
separate(group, into = c("svi", "eji"), sep = "-", convert = TRUE),
aes(x = eji, y = svi, fill = fill),
color = "#dedbd4",
size = 1
) +
scale_fill_identity() +
scale_x_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
scale_y_continuous(breaks = c(1, 3), labels = c("Low", "High"), expand = c(0, 0)) +
labs(x = "EJI →", y = "SVI →") +
theme_minimal() +
theme(
text = element_text(family = default_font_family, size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text = element_text(size = 8),
panel.grid = element_blank(),
plot.background = element_rect(fill = "#dedbd4", color = "#dedbd4")
) +
coord_fixed()
# Add legend to bivariate maps
map_bivariate_pfas_full <- ggdraw() +
draw_plot(map_bivariate_pfas, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
map_bivariate_mp_full <- ggdraw() +
draw_plot(map_bivariate_mp, 0, 0, 1, 1) +
draw_plot(bivariate_legend, 0.75, 0.05, 0.2, 0.2)
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_pfas_full
#ggsave("test.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#f5f4f0")
ggsave("map_bivariate_pfas_full.png", map_bivariate_pfas_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
#| message: false
#| warning: false
#| fig-dpi: 300
#| fig-height: 14
#| fig-width: 14
map_bivariate_mp_full
ggsave("map_bivariate_mp_full.png", map_bivariate_mp_full, width = 14, height = 14, dpi = 300, bg = "#dedbd4")
